"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[187],{3187:(e,t,a)=>{a.r(t),a.d(t,{default:()=>c});var s=a(5155),n=a(2115),i=a(285),l=a(4165),r=a(7481),o=a(9323),d=a(3432);function c(e){let{open:t,onOpenChange:a}=e,{toast:c}=(0,r.dj)(),[x,u]=(0,n.useState)(!1),[m,h]=(0,n.useState)(1),[p,f]=(0,n.useState)(!1),[g,j]=(0,n.useState)([]),[v,w]=(0,n.useState)(!1),y=async()=>{try{u(!0);let e=new URLSearchParams;p&&e.set("includeRevoked","1"),e.set("page",String(m)),e.set("pageSize",String(5));let t=await (0,o.tm)("/api/share?".concat(e.toString())),a=await t.json();if(!t.ok)throw Error((null==a?void 0:a.error)||"加载失败");j(a.data),w(a.hasMore)}catch(e){c({title:"加载失败",description:(null==e?void 0:e.message)||"请稍后重试",variant:"destructive"})}finally{u(!1)}};(0,n.useEffect)(()=>{t&&y()},[t,p,m]);let N=async e=>{try{let t=await (0,o.tm)("/api/share/".concat(e,"/revoke"),{method:"POST"}),a=await t.json();if(!t.ok)throw Error((null==a?void 0:a.error)||"撤销失败");c({title:"已撤销"}),await y()}catch(e){c({title:"撤销失败",description:(null==e?void 0:e.message)||"请稍后重试",variant:"destructive"})}},b=async e=>{try{let t=await (0,o.tm)("/api/share/".concat(e),{method:"DELETE"}),a=await t.json();if(!t.ok)throw Error((null==a?void 0:a.error)||"删除失败");c({title:"已删除"}),await y()}catch(e){c({title:"删除失败",description:(null==e?void 0:e.message)||"请稍后重试",variant:"destructive"})}},k=async e=>{var t,a;let s=((null==(a=window)||null==(t=a.location)?void 0:t.origin)||"")+e;if(await (0,d.c)(s))return void c({title:"已复制"});try{let e=(0,d.U)()?"浏览器限制或权限不足，请手动复制：":"当前为 HTTP 环境，系统复制受限，请手动复制：";window.prompt(e,s)}catch(e){}c({title:"请手动复制",variant:"destructive"})},C=e=>e.expiresAt&&new Date(e.expiresAt).getTime()<Date.now(),S=e=>"number"==typeof e.maxDownloads&&e.maxDownloads>=0&&e.downloadCount>=e.maxDownloads,z=e=>e.revoked||C(e)||S(e),E=e=>e.revoked?"已撤销":C(e)?"已过期":S(e)?"已用尽":"有效";return(0,s.jsx)(l.lG,{open:t,onOpenChange:a,children:(0,s.jsxs)(l.Cf,{className:"sm:max-w-3xl",children:[(0,s.jsx)(l.c7,{children:(0,s.jsx)(l.L3,{children:"分享管理"})}),(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsxs)("div",{className:"text-sm text-muted-foreground",children:["共有 ",g.length," 条分享链接（第 ",m," 页）"]}),(0,s.jsxs)("label",{className:"text-sm flex items-center gap-2",children:[(0,s.jsx)("input",{type:"checkbox",checked:p,onChange:e=>{f(e.target.checked),h(1)}}),"显示已失效（撤销/过期/用尽）"]})]}),(0,s.jsx)("div",{className:"overflow-x-auto border rounded",children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{className:"bg-muted",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"text-left p-2",children:"条目"}),(0,s.jsx)("th",{className:"text-left p-2",children:"链接"}),(0,s.jsx)("th",{className:"text-left p-2",children:"限制"}),(0,s.jsx)("th",{className:"text-left p-2",children:"状态"}),(0,s.jsx)("th",{className:"text-right p-2",children:"操作"})]})}),(0,s.jsx)("tbody",{children:x?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:5,className:"p-4",children:"加载中..."})}):0===g.length?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:5,className:"p-4",children:"暂无分享"})}):g.map(e=>(0,s.jsxs)("tr",{className:"border-t",children:[(0,s.jsxs)("td",{className:"p-2",children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:e.item.type}),(0,s.jsx)("div",{className:"max-w-[16rem] truncate",children:e.item.fileName||e.item.id})]}),(0,s.jsx)("td",{className:"p-2",children:(0,s.jsx)("div",{className:"truncate max-w-[20rem] text-xs",children:e.url})}),(0,s.jsx)("td",{className:"p-2",children:(0,s.jsxs)("div",{className:"text-xs text-muted-foreground",children:[e.expiresAt?"有效期至 ".concat(new Date(e.expiresAt).toLocaleString("zh-CN")):"无有效期","number"==typeof e.maxDownloads&&(0,s.jsxs)(s.Fragment,{children:[" \xb7 下载：",e.downloadCount,"/",e.maxDownloads]}),e.requiresPassword&&(0,s.jsx)(s.Fragment,{children:" \xb7 口令保护"})]})}),(0,s.jsx)("td",{className:"p-2",children:(0,s.jsx)("div",{className:"text-xs ".concat(z(e)?"text-destructive":"text-foreground"),children:E(e)})}),(0,s.jsx)("td",{className:"p-2 text-right",children:(0,s.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,s.jsx)(i.$,{variant:"outline",size:"sm",onClick:()=>k(e.url),children:"复制"}),!e.revoked&&(0,s.jsx)(i.$,{variant:"outline",size:"sm",onClick:()=>N(e.token),children:"撤销"}),(0,s.jsx)(i.$,{variant:"outline",size:"sm",onClick:()=>b(e.token),children:"删除"})]})})]},e.token))})]})}),(0,s.jsxs)("div",{className:"flex justify-between items-center mt-3",children:[(0,s.jsxs)("div",{className:"text-xs text-muted-foreground",children:["每页 ",5," 条"]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(i.$,{variant:"outline",size:"sm",disabled:m<=1,onClick:()=>h(e=>Math.max(1,e-1)),children:"上一页"}),(0,s.jsx)(i.$,{variant:"outline",size:"sm",disabled:!v,onClick:()=>h(e=>e+1),children:"下一页"})]})]})]})})}},3432:(e,t,a)=>{function s(){try{return!!window.isSecureContext}catch(e){return!1}}async function n(e){if(!s())return!1;try{if("undefined"!=typeof navigator&&navigator.clipboard&&"function"==typeof navigator.clipboard.writeText)return await navigator.clipboard.writeText(e),!0}catch(e){}try{let t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style.position="fixed",t.style.opacity="0",t.style.pointerEvents="none",document.body.appendChild(t),t.select();let a=document.execCommand("copy");return document.body.removeChild(t),a}catch(e){return!1}}a.d(t,{U:()=>s,c:()=>n})},4165:(e,t,a)=>{a.d(t,{Cf:()=>x,L3:()=>m,c7:()=>u,lG:()=>r,zM:()=>o});var s=a(5155);a(2115);var n=a(7234),i=a(4416),l=a(9434);function r(e){let{...t}=e;return(0,s.jsx)(n.bL,{"data-slot":"dialog",...t})}function o(e){let{...t}=e;return(0,s.jsx)(n.l9,{"data-slot":"dialog-trigger",...t})}function d(e){let{...t}=e;return(0,s.jsx)(n.ZL,{"data-slot":"dialog-portal",...t})}function c(e){let{className:t,...a}=e;return(0,s.jsx)(n.hJ,{"data-slot":"dialog-overlay",className:(0,l.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...a})}function x(e){let{className:t,children:a,showCloseButton:r=!0,...o}=e;return(0,s.jsxs)(d,{"data-slot":"dialog-portal",children:[(0,s.jsx)(c,{}),(0,s.jsxs)(n.UC,{"data-slot":"dialog-content",className:(0,l.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...o,children:[a,r&&(0,s.jsxs)(n.bm,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,s.jsx)(i.A,{}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function u(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"dialog-header",className:(0,l.cn)("flex flex-col gap-2 text-center sm:text-left",t),...a})}function m(e){let{className:t,...a}=e;return(0,s.jsx)(n.hE,{"data-slot":"dialog-title",className:(0,l.cn)("text-lg leading-none font-semibold",t),...a})}},4416:(e,t,a)=>{a.d(t,{A:()=>s});let s=(0,a(9946).A)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])}}]);