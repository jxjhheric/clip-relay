(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{10:(e,t,a)=>{"use strict";a.d(t,{$v:()=>x,EO:()=>u,Lt:()=>l,Rx:()=>h,Zr:()=>v,ck:()=>p,r7:()=>m,tv:()=>o,wd:()=>f});var r=a(5155);a(2115);var s=a(7649),n=a(9434),i=a(285);function l(e){let{...t}=e;return(0,r.jsx)(s.bL,{"data-slot":"alert-dialog",...t})}function o(e){let{...t}=e;return(0,r.jsx)(s.l9,{"data-slot":"alert-dialog-trigger",...t})}function d(e){let{...t}=e;return(0,r.jsx)(s.ZL,{"data-slot":"alert-dialog-portal",...t})}function c(e){let{className:t,...a}=e;return(0,r.jsx)(s.hJ,{"data-slot":"alert-dialog-overlay",className:(0,n.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...a})}function u(e){let{className:t,...a}=e;return(0,r.jsxs)(d,{children:[(0,r.jsx)(c,{}),(0,r.jsx)(s.UC,{"data-slot":"alert-dialog-content",className:(0,n.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...a})]})}function f(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"alert-dialog-header",className:(0,n.cn)("flex flex-col gap-2 text-center sm:text-left",t),...a})}function p(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"alert-dialog-footer",className:(0,n.cn)("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...a})}function m(e){let{className:t,...a}=e;return(0,r.jsx)(s.hE,{"data-slot":"alert-dialog-title",className:(0,n.cn)("text-lg font-semibold",t),...a})}function x(e){let{className:t,...a}=e;return(0,r.jsx)(s.VY,{"data-slot":"alert-dialog-description",className:(0,n.cn)("text-muted-foreground text-sm",t),...a})}function h(e){let{className:t,...a}=e;return(0,r.jsx)(s.rc,{className:(0,n.cn)((0,i.r)(),t),...a})}function v(e){let{className:t,...a}=e;return(0,r.jsx)(s.ZD,{className:(0,n.cn)((0,i.r)({variant:"outline"}),t),...a})}},285:(e,t,a)=>{"use strict";a.d(t,{$:()=>o,r:()=>l});var r=a(5155);a(2115);var s=a(9708),n=a(2085),i=a(9434);let l=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all cursor-pointer disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function o(e){let{className:t,variant:a,size:n,asChild:o=!1,...d}=e,c=o?s.DX:"button";return(0,r.jsx)(c,{"data-slot":"button",className:(0,i.cn)(l({variant:a,size:n,className:t})),...d})}},2523:(e,t,a)=>{"use strict";a.d(t,{p:()=>n});var r=a(5155);a(2115);var s=a(9434);function n(e){let{className:t,type:a,...n}=e;return(0,r.jsx)("input",{type:a,"data-slot":"input",className:(0,s.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...n})}},5396:(e,t,a)=>{Promise.resolve().then(a.bind(a,9410))},6695:(e,t,a)=>{"use strict";a.d(t,{Wu:()=>l,Zp:()=>n,aR:()=>i});var r=a(5155);a(2115);var s=a(9434);function n(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card",className:(0,s.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...a})}function i(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-header",className:(0,s.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...a})}function l(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-content",className:(0,s.cn)("px-6",t),...a})}},7481:(e,t,a)=>{"use strict";a.d(t,{dj:()=>f});var r=a(2115);let s=0,n=new Map,i=e=>{if(n.has(e))return;let t=setTimeout(()=>{n.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);n.set(e,t)},l=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?i(a):e.toasts.forEach(e=>{i(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},o=[],d={toasts:[]};function c(e){d=l(d,e),o.forEach(e=>{e(d)})}function u(e){let{...t}=e,a=(s=(s+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>c({type:"DISMISS_TOAST",toastId:a});return c({type:"ADD_TOAST",toast:{...t,id:a,open:!0,onOpenChange:e=>{e||r()}}}),{id:a,dismiss:r,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:a}})}}function f(){let[e,t]=r.useState(d);return r.useEffect(()=>(o.push(t),()=>{let e=o.indexOf(t);e>-1&&o.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}},9323:(e,t,a)=>{"use strict";a.d(t,{BE:()=>i,Nj:()=>l,tm:()=>o,z5:()=>n});let r=(a(9509).env.NEXT_PUBLIC_API_BASE||"").replace(/\/$/,""),s="clipboard_password";function n(){let e=sessionStorage.getItem(s);return e?{Authorization:"Bearer ".concat(e)}:{}}async function i(e){try{if((await fetch("".concat(r,"/api/auth/verify"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:e})})).ok)return sessionStorage.setItem(s,e),!0;return!1}catch(e){return console.error("Password verification failed:",e),!1}}function l(){sessionStorage.removeItem(s)}async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.startsWith("http")?e:"".concat(r).concat(e),s={...n(),...t.headers};return fetch(a,{...t,headers:s})}},9410:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>j});var r=a(5155),s=a(2115),n=a(5028),i=a(285),l=a(2523),o=a(6695),d=a(7924),c=a(7434),u=a(10),f=a(7481),p=a(9323),m=a(9509);let x=(0,n.default)(()=>Promise.all([a.e(90),a.e(537)]).then(a.bind(a,9537)),{loadableGenerated:{webpack:()=>[9537]},ssr:!1}),h=(0,n.default)(()=>Promise.all([a.e(709),a.e(154)]).then(a.bind(a,7154)),{loadableGenerated:{webpack:()=>[7154]},ssr:!1}),v=(0,n.default)(()=>a.e(251).then(a.bind(a,3251)),{loadableGenerated:{webpack:()=>[3251]},ssr:!1}),g=(0,n.default)(()=>a.e(187).then(a.bind(a,3187)),{loadableGenerated:{webpack:()=>[3187]},ssr:!1}),b=(0,n.default)(()=>a.e(126).then(a.bind(a,3126)),{loadableGenerated:{webpack:()=>[3126]},ssr:!1});function j(){let e=(m.env.NEXT_PUBLIC_API_BASE||"").replace(/\/$/,""),[t,n]=(0,s.useState)([]),[o,j]=(0,s.useState)(""),[w,S]=(0,s.useState)(!0),[N,k]=(0,s.useState)(null),[E,T]=(0,s.useState)(!1),[I,A]=(0,s.useState)(!1),[_,O]=(0,s.useState)(null),[C,P]=(0,s.useState)(!1),[D,R]=(0,s.useState)(null),[L,z]=(0,s.useState)(!1),[$,M]=(0,s.useState)(null),[B,U]=(0,s.useState)(!1),{toast:W}=(0,f.dj)(),G=(0,s.useRef)(o);(0,s.useEffect)(()=>{G.current=o},[o]),(0,s.useEffect)(()=>{(0,p.Nj)()},[]),(0,s.useEffect)(()=>{a.e(251).then(a.bind(a,3251)).catch(()=>{})},[]);let J=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";try{S(!0);let a=new URLSearchParams;a.set("take","12"),e&&a.set("search",e);let r="/api/clipboard?".concat(a.toString()),s=await (0,p.tm)(r);if(s.ok){var t;let e=await s.json(),a=Array.isArray(e)?e:e.items;n(a),M(null!=(t=null==e?void 0:e.nextCursor)?t:null)}else W({title:"获取数据失败",description:"无法获取剪贴板内容",variant:"destructive"})}catch(e){W({title:"获取数据失败",description:"网络错误，请检查连接",variant:"destructive"})}finally{S(!1)}},V=()=>{M(null),J(o)},Z=async()=>{if($)try{var e;U(!0);let t=new URLSearchParams;t.set("take","24"),t.set("cursorCreatedAt",$.createdAt),t.set("cursorId",$.id),"number"==typeof $.sortWeight&&t.set("cursorSortWeight",String($.sortWeight)),G.current&&t.set("search",G.current);let a=await (0,p.tm)("/api/clipboard?".concat(t.toString())),r=await a.json();if(!a.ok)throw Error((null==r?void 0:r.error)||"加载失败");let s=Array.isArray(r)?r:r.items;n(e=>[...e,...s]),M(null!=(e=null==r?void 0:r.nextCursor)?e:null)}catch(e){W({title:"加载失败",description:(null==e?void 0:e.message)||"请稍后重试",variant:"destructive"})}finally{U(!1)}},F=async e=>{try{let t=await (0,p.tm)("/api/clipboard/".concat(e));if(t.ok){let e=await t.json();k(e)}else W({title:"加载失败",description:"无法加载条目详情",variant:"destructive"})}catch(e){W({title:"网络错误",description:"请检查连接后重试",variant:"destructive"})}},X=e=>{let a=t.find(t=>t.id===e)||null;a&&k(a),F(e)};(0,s.useEffect)(()=>{E&&J()},[E]),(0,s.useEffect)(()=>{if(!E)return;let t=null;try{(t=new EventSource("".concat(e,"/api/events"),{withCredentials:!0})).addEventListener("clipboard:created",e=>{let t=JSON.parse(e.data);G.current?J(G.current):n(e=>{if(e.find(e=>e.id===t.id))return e;let a=[...e],r=e=>{var t;return[null!=(t=e.sortWeight)?t:0,new Date(e.createdAt).getTime(),e.id]},s=r(t),n=0;for(;n<a.length;){var i,l;let e=r(a[n]);if(s[0]>(null!=(i=e[0])?i:0)||s[0]===(null!=(l=e[0])?l:0)&&(s[1]>e[1]||s[1]===e[1]&&s[2]>e[2]))break;n++}return a.splice(n,0,t),a})}),t.addEventListener("clipboard:deleted",e=>{let{id:t}=JSON.parse(e.data);n(e=>e.filter(e=>e.id!==t))}),t.addEventListener("clipboard:reordered",e=>{let t=JSON.parse(e.data),a=(null==t?void 0:t.ids)||[];a.length&&n(e=>{let t=new Map(a.map((e,t)=>[e,t])),r=[...e];return r.sort((e,a)=>{let r=t.has(e.id)?t.get(e.id):Number.POSITIVE_INFINITY,s=t.has(a.id)?t.get(a.id):Number.POSITIVE_INFINITY;return r!==s?r-s:0}),r})})}catch(e){}return()=>{try{null==t||t.close()}catch(e){}}},[E]);let Y=async e=>{try{if("undefined"!=typeof navigator&&navigator.clipboard&&"function"==typeof navigator.clipboard.writeText)await navigator.clipboard.writeText(e);else{let t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}W({title:"已复制到剪贴板",description:"内容已成功复制到剪贴板"})}catch(e){W({title:"复制失败",description:"无法访问剪贴板，请手动复制",variant:"destructive"})}},q=async e=>{try{(await (0,p.tm)("/api/clipboard/".concat(e),{method:"DELETE"})).ok?(n(t=>t.filter(t=>t.id!==e)),W({title:"已删除",description:"条目已成功删除"})):W({title:"删除失败",description:"无法删除条目",variant:"destructive"})}catch(e){W({title:"删除失败",description:"网络错误，请检查连接",variant:"destructive"})}};return E?w?(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-gray-900"})}):(0,r.jsxs)("div",{className:"min-h-screen bg-background p-4 md:p-6",children:[(0,r.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between mb-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold",children:"云剪贴板"}),(0,r.jsx)("p",{className:"text-muted-foreground mt-1",children:"管理您的剪贴板内容"})]}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto",children:[(0,r.jsxs)("div",{className:"flex w-full sm:w-auto gap-2",children:[(0,r.jsx)(l.p,{placeholder:"搜索内容...",value:o,onChange:e=>j(e.target.value),className:"w-full sm:w-64",disabled:w,onKeyDown:e=>{"Enter"===e.key&&V()}}),(0,r.jsxs)(i.$,{onClick:V,disabled:w,children:[(0,r.jsx)(d.A,{className:"h-4 w-4 sm:mr-2"}),(0,r.jsx)("span",{className:"hidden sm:inline",children:"搜索"})]})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(h,{onItemAdded:()=>J(o)}),(0,r.jsx)(i.$,{variant:"outline",onClick:()=>A(!0),children:"分享管理"})]})]})]}),(0,r.jsx)(x,{items:t,onReorder:async e=>{n(e);try{let t=e.map(e=>e.id);if(!(await (0,p.tm)("/api/clipboard/reorder",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ids:t})})).ok)throw Error("reorder failed")}catch(e){W({title:"排序保存失败",description:"稍后将自动恢复",variant:"destructive"}),J(G.current||"")}},onSelectItem:e=>X(e),onCopy:Y,onRequestDelete:e=>{O(e),P(!0)},onRequestShare:e=>{R(e),z(!0)}}),0===t.length&&(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)(c.A,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,r.jsx)("h3",{className:"text-lg font-medium mb-2",children:"暂无剪贴板内容"}),(0,r.jsx)("p",{className:"text-muted-foreground mb-4",children:o?"没有找到匹配的内容":"点击上方按钮添加新的剪贴板内容"}),!o&&(0,r.jsx)(h,{onItemAdded:()=>J(o)})]}),t.length>0&&$&&(0,r.jsx)("div",{className:"flex justify-center mt-6",children:(0,r.jsx)(i.$,{variant:"outline",onClick:Z,disabled:B,children:B?"加载中...":"加载更多"})})]}),(0,r.jsx)(u.Lt,{open:C,onOpenChange:P,children:(0,r.jsxs)(u.EO,{children:[(0,r.jsxs)(u.wd,{children:[(0,r.jsx)(u.r7,{children:"确认删除"}),(0,r.jsx)(u.$v,{children:"删除后将无法恢复。确定要删除该条目吗？"})]}),(0,r.jsxs)(u.ck,{children:[(0,r.jsx)(u.Zr,{children:"取消"}),(0,r.jsx)(u.Rx,{onClick:()=>{_&&q(_),P(!1)},children:"确认删除"})]})]})}),(0,r.jsx)(b,{itemId:D,open:L,onOpenChange:e=>{z(e),e||R(null)}}),(0,r.jsx)(v,{item:N,open:!!N,onOpenChange:e=>!e&&k(null),onDelete:e=>{q(e),k(null)}}),(0,r.jsx)(g,{open:I,onOpenChange:A})]}):(0,r.jsx)(y,{onSuccess:()=>{T(!0),J()}})}function y(e){let{onSuccess:t}=e,[a,n]=(0,s.useState)(""),[d,c]=(0,s.useState)(""),{toast:u}=(0,f.dj)(),m=async()=>{await (0,p.BE)(a)?(u({title:"认证成功",description:"欢迎使用云剪贴板"}),t()):c("密码错误，请重试")};return(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-background",children:(0,r.jsxs)(o.Zp,{className:"w-full max-w-sm",children:[(0,r.jsx)(o.aR,{children:(0,r.jsx)("div",{className:"text-2xl font-semibold",children:"需要认证"})}),(0,r.jsxs)(o.Wu,{className:"space-y-4",children:[(0,r.jsx)("p",{className:"text-muted-foreground",children:"请输入访问密码以继续。"}),(0,r.jsx)(l.p,{type:"password",placeholder:"输入密码...",value:a,onChange:e=>n(e.target.value),onKeyPress:e=>"Enter"===e.key&&m()}),d&&(0,r.jsx)("p",{className:"text-sm text-destructive",children:d}),(0,r.jsx)(i.$,{onClick:m,className:"w-full",children:"解锁"})]})]})})}},9434:(e,t,a)=>{"use strict";a.d(t,{cn:()=>n});var r=a(2596),s=a(9688);function n(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,s.QP)((0,r.$)(t))}}},e=>{var t=t=>e(e.s=t);e.O(0,[352,236,800,441,684,358],()=>t(5396)),_N_E=e.O()}]);