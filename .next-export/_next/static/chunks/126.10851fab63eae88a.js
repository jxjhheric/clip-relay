"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[126],{3126:(e,t,a)=>{a.r(t),a.d(t,{default:()=>u});var n=a(5155),s=a(2115),l=a(285),i=a(2523),o=a(4165),r=a(7481),d=a(9323),c=a(3432);function u(e){let{itemId:t,open:a,onOpenChange:u}=e,{toast:x}=(0,r.dj)(),[m,p]=(0,s.useState)(!1),[f,h]=(0,s.useState)(null),g=(0,s.useRef)(null),[j,v]=(0,s.useState)("86400"),[b,y]=(0,s.useState)(""),[N,w]=(0,s.useState)("");(0,s.useEffect)(()=>{a||(h(null),p(!1),v("86400"),y(""),w(""))},[a]);let k=async()=>{if(t)try{p(!0);let e={itemId:t},a=parseInt(j,10);!isNaN(a)&&a>0&&(e.expiresIn=a),b.trim()&&(e.maxDownloads=Number(b)),N.trim()&&(e.password=N.trim());let n=await (0,d.tm)("/api/share",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),s=await n.json();if(!n.ok)throw Error((null==s?void 0:s.error)||"创建失败");let l=window.location.origin;h(l+s.url)}catch(e){x({title:"创建失败",description:(null==e?void 0:e.message)||"请稍后重试",variant:"destructive"})}finally{p(!1)}};return(0,n.jsx)(o.lG,{open:a,onOpenChange:u,children:(0,n.jsxs)(o.Cf,{className:"sm:max-w-md",children:[(0,n.jsx)(o.c7,{children:(0,n.jsx)(o.L3,{children:"创建分享链接"})}),(0,n.jsx)("div",{className:"space-y-4",children:f?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-sm font-medium mb-1 block",children:"分享链接"}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)(i.p,{readOnly:!0,value:f,ref:g}),(0,n.jsx)(l.$,{onClick:async()=>{if(await (0,c.c)(f))return void x({title:"已复制链接"});try{var e,t;null==(e=g.current)||e.focus(),null==(t=g.current)||t.select()}catch(e){}x({title:"请手动复制",description:(0,c.U)()?"浏览器限制或权限不足":"当前为 HTTP 环境，系统复制受限",variant:"destructive"})},children:"复制"})]}),(0,n.jsx)("div",{className:"mt-2 text-sm text-muted-foreground",children:"任何知道此链接的人都可访问。你可随时在管理页撤销分享。"})]}),(0,n.jsx)("div",{className:"flex justify-end pt-2",children:(0,n.jsx)(l.$,{onClick:()=>u(!1),children:"完成"})})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-sm font-medium mb-1 block",children:"有效期"}),(0,n.jsxs)("select",{className:"w-full rounded border px-2 py-1 text-sm bg-background",value:j,onChange:e=>v(e.target.value),children:[(0,n.jsx)("option",{value:"0",children:"永不过期"}),(0,n.jsx)("option",{value:"3600",children:"1 小时"}),(0,n.jsx)("option",{value:"86400",children:"24 小时"}),(0,n.jsx)("option",{value:"604800",children:"7 天"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-sm font-medium mb-1 block",children:"最大下载次数（可选）"}),(0,n.jsx)(i.p,{type:"number",placeholder:"不限则留空",value:b,onChange:e=>y(e.target.value),min:1})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-sm font-medium mb-1 block",children:"分享口令（可选）"}),(0,n.jsx)(i.p,{type:"password",placeholder:"不设置则留空",value:N,onChange:e=>w(e.target.value)})]}),(0,n.jsxs)("div",{className:"flex justify-end gap-2 pt-2",children:[(0,n.jsx)(l.$,{variant:"outline",onClick:()=>u(!1),children:"取消"}),(0,n.jsx)(l.$,{onClick:k,disabled:m,children:m?"创建中...":"创建"})]})]})})]})})}},3432:(e,t,a)=>{function n(){try{return!!window.isSecureContext}catch(e){return!1}}async function s(e){if(!n())return!1;try{if("undefined"!=typeof navigator&&navigator.clipboard&&"function"==typeof navigator.clipboard.writeText)return await navigator.clipboard.writeText(e),!0}catch(e){}try{let t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style.position="fixed",t.style.opacity="0",t.style.pointerEvents="none",document.body.appendChild(t),t.select();let a=document.execCommand("copy");return document.body.removeChild(t),a}catch(e){return!1}}a.d(t,{U:()=>n,c:()=>s})},4165:(e,t,a)=>{a.d(t,{Cf:()=>u,L3:()=>m,c7:()=>x,lG:()=>o,zM:()=>r});var n=a(5155);a(2115);var s=a(7234),l=a(4416),i=a(9434);function o(e){let{...t}=e;return(0,n.jsx)(s.bL,{"data-slot":"dialog",...t})}function r(e){let{...t}=e;return(0,n.jsx)(s.l9,{"data-slot":"dialog-trigger",...t})}function d(e){let{...t}=e;return(0,n.jsx)(s.ZL,{"data-slot":"dialog-portal",...t})}function c(e){let{className:t,...a}=e;return(0,n.jsx)(s.hJ,{"data-slot":"dialog-overlay",className:(0,i.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...a})}function u(e){let{className:t,children:a,showCloseButton:o=!0,...r}=e;return(0,n.jsxs)(d,{"data-slot":"dialog-portal",children:[(0,n.jsx)(c,{}),(0,n.jsxs)(s.UC,{"data-slot":"dialog-content",className:(0,i.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...r,children:[a,o&&(0,n.jsxs)(s.bm,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,n.jsx)(l.A,{}),(0,n.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function x(e){let{className:t,...a}=e;return(0,n.jsx)("div",{"data-slot":"dialog-header",className:(0,i.cn)("flex flex-col gap-2 text-center sm:text-left",t),...a})}function m(e){let{className:t,...a}=e;return(0,n.jsx)(s.hE,{"data-slot":"dialog-title",className:(0,i.cn)("text-lg leading-none font-semibold",t),...a})}},4416:(e,t,a)=>{a.d(t,{A:()=>n});let n=(0,a(9946).A)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])}}]);