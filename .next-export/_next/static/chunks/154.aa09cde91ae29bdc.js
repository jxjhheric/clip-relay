"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[154],{4165:(e,t,a)=>{a.d(t,{Cf:()=>u,L3:()=>m,c7:()=>x,lG:()=>i,zM:()=>o});var l=a(5155);a(2115);var s=a(7234),n=a(4416),r=a(9434);function i(e){let{...t}=e;return(0,l.jsx)(s.bL,{"data-slot":"dialog",...t})}function o(e){let{...t}=e;return(0,l.jsx)(s.l9,{"data-slot":"dialog-trigger",...t})}function d(e){let{...t}=e;return(0,l.jsx)(s.ZL,{"data-slot":"dialog-portal",...t})}function c(e){let{className:t,...a}=e;return(0,l.jsx)(s.hJ,{"data-slot":"dialog-overlay",className:(0,r.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...a})}function u(e){let{className:t,children:a,showCloseButton:i=!0,...o}=e;return(0,l.jsxs)(d,{"data-slot":"dialog-portal",children:[(0,l.jsx)(c,{}),(0,l.jsxs)(s.UC,{"data-slot":"dialog-content",className:(0,r.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...o,children:[a,i&&(0,l.jsxs)(s.bm,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,l.jsx)(n.A,{}),(0,l.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function x(e){let{className:t,...a}=e;return(0,l.jsx)("div",{"data-slot":"dialog-header",className:(0,r.cn)("flex flex-col gap-2 text-center sm:text-left",t),...a})}function m(e){let{className:t,...a}=e;return(0,l.jsx)(s.hE,{"data-slot":"dialog-title",className:(0,r.cn)("text-lg leading-none font-semibold",t),...a})}},7154:(e,t,a)=>{a.r(t),a.d(t,{default:()=>p});var l=a(5155),s=a(2115),n=a(285),r=a(9434);function i(e){let{className:t,...a}=e;return(0,l.jsx)("textarea",{"data-slot":"textarea",className:(0,r.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),...a})}var o=a(5863);function d(e){let{className:t,value:a,...s}=e;return(0,l.jsx)(o.bL,{"data-slot":"progress",className:(0,r.cn)("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",t),...s,children:(0,l.jsx)(o.C1,{"data-slot":"progress-indicator",className:"bg-primary h-full w-full flex-1 transition-all",style:{transform:"translateX(-".concat(100-(a||0),"%)")}})})}var c=a(4165),u=a(7481),x=a(9323),m=a(3464),f=a(4616),g=a(9890);function p(e){let{onItemAdded:t}=e,[a,r]=(0,s.useState)(!1),[o,p]=(0,s.useState)(""),[h,v]=(0,s.useState)(null),[b,j]=(0,s.useState)(!1),[N,y]=(0,s.useState)(null),w=(0,s.useRef)(null),{toast:k}=(0,u.dj)(),C=e=>{v(e)},z=()=>{p(""),v(null),j(!1),y(null)},A=e=>{try{var t,a;let l=null==(t=e.clipboardData)?void 0:t.items;if(!l)return;for(let e=0;e<l.length;e++){let t=l[e];if("file"===t.kind||t.type&&t.type.startsWith("image/")){let e=null==(a=t.getAsFile)?void 0:a.call(t);if(e){v(e),k({title:"已获取粘贴的图片",description:"".concat(e.name||"image"," (").concat((e.size/1024/1024).toFixed(2)," MB)")});break}}}}catch(e){}},D=async()=>{if(!o.trim()&&!h)return void k({title:"请输入内容或上传文件",description:"内容和文件不能同时为空",variant:"destructive"});y(0),w.current=new AbortController;try{let e=new FormData;e.append("content",o);let a="TEXT";h&&(a=h.type.startsWith("image/")?"IMAGE":"FILE",e.append("file",h)),e.append("type",a),await m.A.post("/api/clipboard",e,{headers:{...(0,x.z5)(),"Content-Type":"multipart/form-data"},signal:w.current.signal,onUploadProgress(e){let t=Math.round(100*e.loaded/(e.total||1));y(t)}}),k({title:"添加成功"}),z(),r(!1),t()}catch(e){m.A.isCancel(e)?k({title:"已取消上传"}):k({title:"上传失败",description:(null==e?void 0:e.message)||"请稍后重试",variant:"destructive"})}finally{y(null),w.current=null}};return(0,l.jsxs)(c.lG,{open:a,onOpenChange:e=>{r(e),e||z()},children:[(0,l.jsx)(c.zM,{asChild:!0,children:(0,l.jsxs)(n.$,{children:[(0,l.jsx)(f.A,{className:"h-4 w-4 mr-2"}),"添加条目"]})}),(0,l.jsxs)(c.Cf,{className:"sm:max-w-md max-h[80vh] flex flex-col",onPaste:A,children:[(0,l.jsx)(c.c7,{children:(0,l.jsx)(c.L3,{children:"添加新条目"})}),(0,l.jsxs)("div",{className:"flex-1 overflow-y-auto space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"内容"}),(0,l.jsx)("div",{className:"relative",children:(0,l.jsx)(i,{placeholder:"输入文本内容...",value:o,onChange:e=>p(e.target.value),rows:6,className:"resize-none max-h-48"})})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"上传文件"}),(0,l.jsx)("div",{className:"cursor-pointer border-2 border-dashed rounded-lg p-6 text-center transition-colors ".concat(b?"border-primary bg-primary/5":h?"border-green-500 bg-green-50":"border-gray-300 hover:border-gray-400"),onDrop:e=>{e.preventDefault(),j(!1);let t=e.dataTransfer.files[0];t&&C(t)},onDragOver:e=>{e.preventDefault(),j(!0)},onDragLeave:e=>{e.preventDefault(),j(!1)},onPaste:A,tabIndex:0,children:h?(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(g.A,{className:"h-8 w-8 text-green-600 mx-auto"}),(0,l.jsx)("p",{className:"text-sm font-medium",children:h.name}),(0,l.jsxs)("p",{className:"text-xs text-muted-foreground",children:[(h.size/1024/1024).toFixed(2)," MB"]}),(0,l.jsx)(n.$,{variant:"outline",size:"sm",onClick:()=>v(null),children:"重新选择"})]}):(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(g.A,{className:"h-8 w-8 text-muted-foreground mx-auto"}),(0,l.jsx)("p",{className:"text-sm text-muted-foreground",children:"拖拽文件到此处、点击选择，或在此处按 Ctrl+V 粘贴图片"}),(0,l.jsx)("input",{type:"file",onChange:e=>{var t;let a=null==(t=e.target.files)?void 0:t[0];a&&C(a)},className:"hidden",id:"file-upload"}),(0,l.jsx)(n.$,{variant:"outline",size:"sm",onClick:()=>{var e;return null==(e=document.getElementById("file-upload"))?void 0:e.click()},children:"选择文件"})]})}),null!==N&&(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(d,{value:N,className:"w-full"}),(0,l.jsx)("p",{className:"text-sm text-center text-muted-foreground",children:N<100?"上传中... ".concat(N,"%"):"处理中..."})]})]}),(0,l.jsxs)("div",{className:"flex justify-between items-center pt-4 border-t bg-background",children:[(0,l.jsx)("div",{className:"text-xs text-muted-foreground"}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)(n.$,{variant:"outline",onClick:()=>{if(null!==N){var e;null==(e=w.current)||e.abort()}else r(!1)},children:"取消"}),(0,l.jsx)(n.$,{onClick:D,disabled:null!==N,children:null!==N?"上传中...":"添加"})]})]})]})]})]})}}}]);